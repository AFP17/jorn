# Battle UI Technical Overhaul Plan (based on pokemon-battle.tsx)## GoalThe primary goal of this plan is to refactor the existing `CombatView.tsx` component to adopt the technical architecture, layout structure, and implementation patterns found in the `pokemon-battle.tsx` component. This will maintain all current Jorn RPG gameplay mechanics, terminology, and visual styling while improving the underlying UI architecture for better maintainability, performance, and extensibility.## Technical Architecture Analysis of `pokemon-battle.tsx`The `pokemon-battle.tsx` component provides a robust technical framework for turn-based battle UI, characterized by:1.  **Modular Layout Architecture**: A clear separation between the main battle arena (relative container with absolute-positioned elements) and the interface area (message box and action menu sections).2.  **Percentage-Based Positioning System**: Characters and UI elements within the battle arena use percentage-based absolute coordinates, enabling responsive and flexible layouts.3.  **Configuration-Driven Styling**: Centralized `BattleSceneConfig` object allows for runtime customization of colors, fonts, backgrounds, positioning, and UI element styles without code changes.4.  **Component-Based Status Rendering**: Dedicated rendering functions for status bars with consistent positioning and styling patterns.5.  **State-Driven Menu System**: Hierarchical menu system with clear state management for different interaction modes and sub-menus.6.  **Animation State Management**: Structured animation system using state objects with progress tracking, duration control, and cleanup mechanisms.7.  **Type-Safe Configuration**: Strong TypeScript interfaces for configuration objects, positioning data, and component state.

## Technical Implementation PlanThis plan outlines the steps to transition `CombatView.tsx` to adopt the technical architecture patterns. The focus is on implementation structure rather than visual or gameplay changes.### Phase 1: Core Architecture and Configuration1.  **Implement Layout Architecture**: Restructure `CombatView.tsx` to use the two-section layout: battle arena (relative container with fixed height) and interface area (message box + menu sections). Maintain current styling but use the new structure.2.  **Create Battle Configuration System**: Implement a `JornBattleConfig` interface (adapted from `BattleSceneConfig`) to centralize positioning, styling, and behavior configuration. This should include positioning for player/enemy elements, styling options, and animation settings.3.  **Adopt Percentage-Based Positioning**: Convert character rendering from current positioning to percentage-based absolute positioning within the battle arena container.4.  **Extend Existing Types**: Add positioning and rendering data to existing types (`Player`, `Enemy`) without changing core gameplay data. Add `position: { x: number, y: number }` properties and any visual configuration needed.### Phase 2: Component Rendering Architecture1.  **Implement Dedicated Rendering Functions**: Create separate rendering functions for different UI elements (`renderPlayerStatus`, `renderEnemyStatus`, `renderCharacterSprite`) following the pattern from `pokemon-battle.tsx` but adapted for Jorn's data structures.2.  **Centralize Status Bar Logic**: Extract current status bar rendering into dedicated functions with configurable positioning and styling, using the same HP bar, status effects, and character information but with the new positioning system.3.  **Abstract Character Rendering**: Create a unified character rendering system that handles both Player and Enemy rendering with configurable positioning, scaling, and visual effects.### Phase 3: State-Driven Menu System1.  **Implement Menu State Management**: Adopt the hierarchical menu state pattern (`selectedAction`, sub-menu states) to replace current action selection logic. Keep existing actions (Attack, Defend, Items, Abilities, Flee) but structure them using the new state management pattern.2.  **Create Menu Rendering System**: Implement dedicated rendering functions for main menu and sub-menus, maintaining current functionality but using the structured approach from `pokemon-battle.tsx`.3.  **Integrate with Existing Game Logic**: Ensure menu selections properly trigger existing battle functions (`playerAttack`, `handleUseConsumable`, `handleUseAbility`, etc.) without changing the underlying game mechanics.4.  **Enhance Message System**: Improve message box to use structured message handling with proper state management.### Phase 4: Animation and Effect Framework1.  **Implement Animation State System**: Add structured animation state management (`AnimationState` objects) to handle attack, damage, and other visual effects using the pattern from `pokemon-battle.tsx`.2.  **Add Visual Effect Rendering**: Implement visual indicators for status effects, damage numbers, and other battle feedback using the animation framework.3.  **Integrate with Battle Events**: Connect the animation system to existing battle event triggers without changing the underlying combat logic.4.  **Performance Optimization**: Use the animation cleanup and performance patterns from `pokemon-battle.tsx` to ensure smooth performance.

## Technical Considerations and Implementation Notes*   **Configuration Management**: Implement `JornBattleConfig` as a prop to `CombatView.tsx` with sensible defaults. This allows for future customization without code changes while maintaining the current visual style.*   **State Management Integration**: Ensure the new UI state (menu states, animation states) integrates cleanly with existing battle state management in `App.tsx`. Use `useState` patterns consistent with the current codebase.*   **Backward Compatibility**: Maintain all existing battle function signatures and game logic. The refactor should be purely architectural with no changes to combat mechanics, spell effects, or game balance.*   **Performance Considerations**: Implement proper cleanup for animations and effects. Use React patterns like `useCallback` and `useEffect` cleanup functions as demonstrated in `pokemon-battle.tsx`.*   **Type Safety**: Extend existing TypeScript interfaces rather than replacing them. Add new properties for positioning and rendering configuration while preserving all current game data structures.*   **Incremental Migration**: Design the refactor to be done incrementally, allowing the game to remain functional throughout the process. Each phase should result in a working battle system.## Future Enhancement Opportunities*   **Drag-and-Drop Layout Customization**: The technical framework from `pokemon-battle.tsx` includes sophisticated drag-and-drop positioning. This could be adapted for Jorn to allow players to customize battle UI layouts.*   **Enhanced Animation System**: The animation framework can be extended to support more complex visual effects while maintaining game performance.*   **Configuration Persistence**: Save and load battle UI configurations for personalized player experiences.*   **Accessibility Enhancements**: The structured approach makes it easier to add accessibility features like screen reader support and high contrast modes.This plan focuses on adopting proven technical patterns while preserving the unique identity and mechanics of the Jorn RPG game. 